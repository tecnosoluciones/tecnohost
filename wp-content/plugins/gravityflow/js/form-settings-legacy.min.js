!function(l,f){"use strict";function c(t,e){var i=f("#gaddon-setting-tab-field-"+e+"_notification_type");i.toggle(t),t?(o(i.find("input[type=radio]:checked").val(),e),f("#gaddon-setting-tab-tab_"+e+"_notification i.gravityflow-tab-checked").show(),f("#gaddon-setting-tab-tab_"+e+"_notification i.gravityflow-tab-unchecked").hide()):(o("off",e),f("#gaddon-setting-tab-tab_"+e+"_notification i.gravityflow-tab-checked").hide(),f("#gaddon-setting-tab-tab_"+e+"_notification i.gravityflow-tab-unchecked").show())}function o(i,t){var e=["users","routing","from_name","from_email","reply_to","cc","bcc","subject","message","autoformat","resend","gpdf"],o="#gaddon-setting-tab-field-"+t+"_notification_";f.each(e,function(t,e){f(o+e).hide()}),"off"!=i&&f.each(e,function(t,e){if("users"==e&&"routing"==i||"routing"==e&&"select"==i)return!0;f(o+e).fadeToggle("normal")})}function g(t){e({select:["workflow_notification_users\\[\\]","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","workflow_email_custom_file_name","workflow_notification_gpdf"],routing:["workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","workflow_email_custom_file_name","workflow_notification_gpdf"]},t,!1)}function d(t){e({select:["assignees\\[\\]","editable_fields\\[\\]","conditional_logic_editable_fields_enabled"],routing:["routing","conditional_logic_editable_fields_enabled"]},t)}function e(t,i,e){var o=e?"#gaddon-setting-tab-field-":"#gaddon-setting-row-";f.each(t,function(t,e){f.each(e,function(t,e){f(o+e).hide()})}),f.each(t,function(t,e){i==t&&f.each(e,function(t,e){f(o+e).fadeToggle("normal")})})}function u(t){var e=f("#gaddon-setting-row-workflow_notification_type");e.toggle(t),g(t?e.find("input[type=radio]:checked").val():"off")}f(document).ready(function(){f("#editable_fields, .gravityflow-multiselect-ui").multiSelect();var n={selectableHeader:"<input type='text' class='search-input' autocomplete='off' placeholder='"+gravityflow_form_settings_js_strings.assigneeSearchPlaceholder+"'>",selectionHeader:"<input type='text' class='search-input' autocomplete='off' placeholder='"+gravityflow_form_settings_js_strings.assigneeSearchPlaceholder+"'>",afterInit:function(t){var e=this,i=e.$selectableUl.prev(),o=e.$selectionUl.prev(),n="#"+t.attr("id")+" .ms-elem-selectable:not(.ms-selected)",a="#"+t.attr("id")+" .ms-elem-selection.ms-selected";10<f("#"+t.attr("id")+" .ms-elem-selectable").length&&f(".ms-container .search-input").show(),e.qs1=i.quicksearch(n).on("keydown",function(t){if(40===t.which)return e.$selectableUl.focus(),!1}),e.qs2=o.quicksearch(a).on("keydown",function(t){if(40==t.which)return e.$selectionUl.focus(),!1})},afterSelect:function(){this.qs1.cache(),this.qs2.cache()},afterDeselect:function(){this.qs1.cache(),this.qs2.cache()}},t=(f("#assignees, #workflow_notification_users").multiSelect(n),!1),e=!1;f("form#gform-settings").submit(function(){e=!0,f("form#gform-settings").find(":input").removeAttr("disabled")}),f(":input").change(function(){t=!0}),window.onbeforeunload=function(){if(t&&!e)return"You have unsaved changes."};f("input[name=_gaddon_setting_step_type]:checked").val();var i=f("#status_expiration"),o="expired"==i.val();f("#expiration_sub_setting_destination_expired").toggle(o),i.change(function(){"expired"==f(this).val()?f("#expiration_sub_setting_destination_expired").show():f("#expiration_sub_setting_destination_expired").hide()});for(var a=["routing","assignees\\[\\]","assignee_notification_from_name","assignee_notification_from_email","assignee_notification_reply_to","assignee_notification_cc","assignee_notification_bcc","assignee_notification_subject","assignee_notification_message","assignee_notification_autoformat","resend_assignee_email","assignee_notification_gpdf","rejection_notification_type","rejection_notification_users\\[\\]","rejection_notification_user_field","rejection_notification_routing","rejection_notification_message","rejection_notification_autoformat","approval_notification_type","approval_notification_users\\[\\]","approval_notification_user_field","approval_notification_routing","approval_notification_message","approval_notification_autoformat","workflow_notification_type","workflow_notification_users\\[\\]","workflow_notification_user_field","workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","assignees\\[\\]","editable_fields\\[\\]","routing","assignee_notification_message","workflow_notification_gpdf"],s=0;s<a.length;s++)f("#gaddon-setting-row-"+a[s]).addClass("gravityflow_sub_setting");d(f("input[name=_gaddon_setting_type]:checked").val()),f("#gaddon-setting-row-type input[type=radio]").change(function(){d(this.value)}),l.getUsersMarkup=function(t){for(var e,i=gf_routing_setting_strings.accounts,o='<select class="gform-routing-users '+t+'_{i}">',n=0;n<i.length;n++)if(void 0!==(e=i[n]).choices){for(var a,s="",r=0;r<e.choices.length;r++)a=e.choices[r],s+='<option value="{0}">{1}</option>'.format(a.value,a.label);o+='<optgroup label="{0}">{1}</option>'.format(e.label,s)}else o+='<option value="{0}">{1}</option>'.format(e.value,e.label);return o+="</select>"};o=f("#gform_routing_setting"),i=f("#routing").val(),i=i?f.parseJSON(i):null,i=0<f("#editable_fields").length?(i||(i=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,editable_fields:[gf_routing_setting_strings.input_fields[0].key],fieldId:"0",operator:"is",value:"",type:""}],f("#user_input_routing").val(f.toJSON(i))),{fieldName:o.data("field_name"),fieldId:o.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:i,callbacks:{addNewTarget:function(t,e){var i=l.getUsersMarkup("assignee"),o=f("#editable_fields").clone();o.attr("name","editable_fields"),f("#gform-routings tbody tr").length;return o.attr("id","editable_fields_routing_{i}"),o.attr("style",""),o.addClass("gform-routing-input-field editable_fields_{i}"),i+="</td><td>"+o[0].outerHTML},header:function(t,e){return'<thead><tr><th>Assign To</th><th>Editable Fields</th><th colspan="3">Condition</th></tr></thead>'}}}):(i||(i=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],f("#routing").val(f.toJSON(i))),{fieldName:o.data("field_name"),fieldId:o.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:i,callbacks:{addNewTarget:function(t,e){return l.getUsersMarkup("assignee")}}});o.gfRoutingSetting(i),f("#gaddon-setting-row-workflow_notification_type input[type=radio]").click(function(){g(this.value)});u(f("#workflow_notification_enabled").prop("checked")),f("#workflow_notification_enabled").click(function(){u(this.checked)});for(var o=f("#gform_user_routing_setting_workflow_notification_routing"),i=f("#workflow_notification_routing").val(),i=i?f.parseJSON(i):null,i=(i||(i=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],f("#workflow_notification_routing").val(f.toJSON(i))),{fieldName:o.data("field_name"),fieldId:o.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:i,callbacks:{addNewTarget:function(t,e){return l.getUsersMarkup("assignee")}}}),r=(o.gfRoutingSetting(i),l.initNotificationTab=function(t){f("#"+t+"_notification_users").multiSelect(n);var e,i,o=f("#"+t+"_notification_enabled"),o=(c(o.prop("checked"),t),o.click(function(){c(this.checked,t)}),f("#gaddon-setting-tab-field-"+t+"_notification_type input[type=radio]").click(function(){c(!0,t)}),f("#gform_user_routing_setting_"+t+"_notification_routing"));o.length&&((e=(e=(i=f("#"+t+"_notification_routing")).val())?f.parseJSON(e):null)||(e=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],i.val(f.toJSON(e))),i={fieldName:o.data("field_name"),fieldId:o.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:e,callbacks:{addNewTarget:function(t,e){return l.getUsersMarkup("assignee")}}},o.gfRoutingSetting(i))},["assignee","rejection","approval","in_progress","complete","revert"]),_=0;_<r.length;_++)l.initNotificationTab(r[_]);o=f("#default_status"),"hidden"===o.val()&&f("#tabs-notification_tabs").tabs("disable",1),o.change(function(){var t="hidden"===f(this).val(),e=f("#tabs-notification_tabs");t?((t=f("#in_progress_notification_enabled")).prop("checked")&&t.click(),1===e.tabs("option","active")&&e.tabs("option","active",0),e.tabs("disable",1)):e.tabs("enable",1)}),i=f("#revertenable");i.prop("checked")||(f("#tabs-notification_tabs").tabs("disable",3),f("#gaddon-setting-row-reverted_message").hide()),i.change(function(){var t=f(this).prop("checked"),e=f("#tabs-notification_tabs");t?(e.tabs("enable",3),f("#gaddon-setting-row-reverted_message").show()):((t=f("#revert_notification_enabled")).prop("checked")&&t.click(),1===e.tabs("option","active")&&e.tabs("option","active",0),e.tabs("disable",3),f("#gaddon-setting-row-reverted_message").hide())}),window.gform&&gform.addFilter("gform_merge_tags",l.gravityflow_add_merge_tags),window.gformInitDatepicker&&gformInitDatepicker(),0<(o=gravityflow_form_settings_js_strings.feedId)&&(o=ajaxurl+"?action=gravityflow_feed_message&fid="+o+"&id="+gravityflow_form_settings_js_strings.formId,f.get(o,function(t){f("#save_button").before(t)}))}),l.gravityflow_add_merge_tags=function(t,e,i,o,n,a){var s,r;return n||(n=t,["_gaddon_setting_workflow_notification_message","_gaddon_setting_assignee_notification_message","_gaddon_setting_approval_notification_message","_gaddon_setting_rejection_notification_message","_gaddon_setting_revert_notification_message","_gaddon_setting_complete_notification_message","_gaddon_setting_in_progress_notification_message"].indexOf(s=e)<0||(s=gravityflow_form_settings_js_strings.mergeTagLabels,(r=[]).push({tag:"{workflow_entry_link}",label:s.workflow_entry_link}),r.push({tag:"{workflow_entry_url}",label:s.workflow_entry_url}),r.push({tag:"{workflow_inbox_link}",label:s.workflow_inbox_link}),r.push({tag:"{workflow_inbox_url}",label:s.workflow_inbox_url}),r.push({tag:"{workflow_cancel_link}",label:s.workflow_cancel_link}),r.push({tag:"{workflow_cancel_url}",label:s.workflow_cancel_url}),r.push({tag:"{workflow_note}",label:s.workflow_note}),r.push({tag:"{workflow_timeline}",label:s.workflow_timeline}),r.push({tag:"{assignees}",label:s.assignees}),n.gravityflow={label:s.group,tags:r}),n=t,["_gaddon_setting_assignee_notification_message"].indexOf(s=e)<0)||(s=gravityflow_form_settings_js_strings.mergeTagLabels,(r=[]).push({tag:"{workflow_approve_link}",label:s.workflow_approve_link}),r.push({tag:"{workflow_approve_url}",label:s.workflow_approve_url}),r.push({tag:"{workflow_approve_token}",label:s.workflow_approve_token}),r.push({tag:"{workflow_reject_link}",label:s.workflow_reject_link}),r.push({tag:"{workflow_reject_url}",label:s.workflow_reject_url}),r.push({tag:"{workflow_reject_token}",label:s.workflow_reject_token}),f("#revertenable").prop("checked")&&(r.push({tag:"{workflow_revert_link}",label:s.workflow_revert_link}),r.push({tag:"{workflow_revert_url}",label:s.workflow_revert_url}),r.push({tag:"{workflow_revert_token}",label:s.workflow_revert_token})),void 0!==n.gravityflow?n.gravityflow.tags=f.merge(n.gravityflow.tags,r):n.gravityflow={label:s.group,tags:r}),t}}(window.GravityFlowFeedSettings=window.GravityFlowFeedSettings||{},jQuery);