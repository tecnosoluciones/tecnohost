!function(n){"use strict";var i="gfRoutingSetting",r={prefix:"",allowMultiple:!0,imagesURL:"",operatorStrings:{is:"is",isnot:"isNot",">":"greaterThan","<":"lessThan",contains:"contains",starts_with:"startsWith",ends_with:"endsWith"},items:[{target:"",fieldId:"0",operator:"is",value:"",type:""}],callbacks:{addNewTarget:function(){},header:function(){return'<thead><tr><th>Assign To</th><th colspan="3">Condition</th></tr></thead>'}}};function e(t,e){this.element=t,this.$element=n(t),this.options=n.extend(!0,{},r,e),this.prefix=e.prefix,this.settings=e.settings,this.accounts=e.accounts,this._defaults=r,this._name=i,this.init()}e.prototype={init:function(){var o=this,t=this.getHeaderMarkup(),t='<table class="gform-routings">{0}<tbody class="repeater">{1}</tbody></table>'.format(t,this.getNewRoutingRow()),t=n(t);t.find(".repeater").repeater({limit:0,items:this.options.items,addButtonMarkup:'<img class="gform-add" src="{0}/images/add.png" />'.format(gf_vars.baseUrl),removeButtonMarkup:'<img class="gform-remove" src="{0}/images/remove.png" />'.format(gf_vars.baseUrl),callbacks:{save:function(t,e){n("#"+o.options.fieldId).val(n.toJSON(e))},beforeAdd:function(t,e,i){e.find(".gform-routing-target").val(i.target);var r=e.find(".gform-routing-field").first(),r=(r.value=i.fieldId,o.changeField(r),e.find(".gform-routing-operator").first());r.value=i.operator,o.changeOperator(r),e.find(".gform-routing-value").val(i.value)}}}).on("change",".gform-routing-field",function(t){o.changeField(this)}).on("click",".gform-no-filters",function(t){var e=n(this);0==e.find(".gform-routing").length&&o.addNewRouting(this),e.remove(),t.preventDefault()}).on("change",".gform-routing-operator",function(){o.changeOperator(this)}),this.$element.append(t)},getHeaderMarkup:function(){return this.options.callbacks.header(this,"")},getNewRoutingRow:function(){var t=[];return t.push("<td>{0}</td>".format(this.getRoutingTarget())),t.push("<td>{0}</td>".format(this.getRoutingFields())),t.push("<td>{0}</td>".format(this.getRoutingOperators(this.options.settings[0]))),t.push("<td>{0}</td>".format(this.getRoutingValues())),t.push("<td>{buttons}</td>"),'<tr class="gform-routing-row">{0}</tr>'.format(t.join(""))},getRoutingTarget:function(){return this.options.callbacks.addNewTarget(this,'<input type="text" class="gform-routing-target target_{i}">')},getRoutingFields:function(){var t,e,i,r,o,n,s,a,u=[],g=this.settings;for(u.push('<select class="gform-routing-field fieldId_{i}" >'),t=0;t<g.length;t++)if(i=g[t].key,g[t].group){for(n=g[t].text,a=g[t].filters.length,s=[],e=0;e<a;e++)o=g[t].filters[e].text,r=g[t].filters[e].key,s.push('<option value="{0}">{1}</option>'.format(r,o));u.push('<optgroup label="{0}">{1}</optgroup>'.format(n,s.join("")))}else o=g[t].text,u.push('<option value="{0}">{1}</option>'.format(i,o));return u.push("</select>"),u.push('<input type="hidden" class="gform-filter-type" name="type_{i}" value="" >'),u.join("")},changeOperator:function(t){var e=n(t),i=e.closest("tr").find(".repeater-buttons").find(".add-item ").data("index"),r=e.closest("tr").find(".gform-routing-field"),r=this.getFilter(r.value);r&&e.closest("tr").find(".gform-routing-value").replaceWith(this.getRoutingValues(r,t.value,i))},changeField:function(t){var e,i=this.getFilter(t.value);i&&(e=(t=n(t)).closest("tr").find(".repeater-buttons").find(".add-item ").data("index"),t.closest("tr").find(".gform-routing-value").replaceWith(this.getRoutingValues(i,null,e)),t.closest("tr").find(".gform-filter-type").val(i.type).change(),i=n(this.getRoutingOperators(i,e)),t.closest("tr").find(".gform-routing-operator").replaceWith(i),t.closest("tr").find(".gform-routing-operator").change())},getRoutingOperators:function(t,e){var i,r,o=this.options.operatorStrings,n='<select class="gform-routing-operator operator_{0}">'.format(e=null==e?"{i}":e);if(t)for(i=0;i<t.operators.length;i++)r=t.operators[i],n+='<option value="{0}">{1}</option>'.format(r,gf_vars[o[r]]);return n+="</select>"},getRoutingValues:function(t,e,i){var r,o,n,s,a="";if(null==i&&(i="{i}"),t&&t.values&&"contains"!=e){for(r=0;r<t.values.length;r++)o=t.values[r].value,n=t.values[r].text,a+='<option value="{0}">{1}</option>'.format(o,n);s='<select class="gform-routing-value value_{0}">{1}</select>'.format(i,a)}else s='<input type="text" value="" class="gform-routing-value value_{0}" />'.format(i);return s},getFilter:function(t){var e=this.settings;if(t)for(var i=0;i<e.length;i++){if(t==e[i].key)return e[i];if(e[i].group)for(var r=0;r<e[i].filters.length;r++)if(t==e[i].filters[r].key)return e[i].filters[r]}},selected:function(t,e){return t==e?'selected="selected"':""}},n.fn[i]=function(t){return this.each(function(){n.data(this,"plugin_"+i)||n.data(this,"plugin_"+i,new e(this,t))})},String.prototype.format=function(){var i=arguments;return this.replace(/{(\d+)}/g,function(t,e){return void 0!==i[e]?i[e]:t})}}((window.GFRoutingSetting=window.GFRoutingSetting||{},jQuery));